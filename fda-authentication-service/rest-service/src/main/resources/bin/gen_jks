#!/bin/bash
KEY_STORE_LOCATION="/tmp/dbrepo.p12"
JKS_LOCATION="/tmp/dbrepo.jks"
KEY_STORE_ALIAS="1"
KEY_STORE_PASS="dbrepo"

SSL_PASS="dbrepo"

TU_ALIAS="tu"

SAML_STORE_LOCATION="/tmp/saml.p12"
SAML_ALIAS="saml"
SAML_KEY="/tmp/saml_sign.key"
SAML_CERTIFICATE="/tmp/saml_sign.pem"
SAML_PASS="dbrepo"

# GENERATE SSL PRIVATE KEY AND PUBLIC KEY IN KEYSTORE
echo "Generate self-signed certificate ..."
keytool -genkey -keyalg RSA -alias "${KEY_STORE_ALIAS}" -storetype PKCS12 \
  -dname "cn=FAIR Data Austria, ou=Zentrum fÃ¼r Forschungsdatenmanagement, o=TU Wien, c=AT, l=Vienna, st=Austria" \
  -keystore "${KEY_STORE_LOCATION}" -storepass "${KEY_STORE_PASS}" -validity 3650 \
  -keysize 4096 > /dev/null 2>&1

# CONVERT PKCS12 KEYSTORE TO JKS
echo "Convert to .jks ..."
keytool -importkeystore -srckeystore "${KEY_STORE_LOCATION}" -destkeystore "${JKS_LOCATION}" -srcstoretype PKCS12 \
  -deststoretype jks -srcstorepass "${KEY_STORE_PASS}" -deststorepass "${KEY_STORE_PASS}" \
  -srcalias "${KEY_STORE_ALIAS}" -destalias "${KEY_STORE_ALIAS}" -srckeypass "${SSL_PASS}" \
  -destkeypass "${SSL_PASS}"
